{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">⚖️ Consultas Jurídicas</h1>
        {% if current_user.rol in ['Admin', 'Responsable_SST'] %}
        <a href="{{ url_for('juridico.crear') }}" 
           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            + Nueva Consulta
        </a>
        {% endif %}
    </div>
    
    <!-- Estadísticas -->
    <div class="grid grid-cols-6 gap-4 mb-6">
        <div class="bg-white p-4 rounded shadow">
            <p class="text-gray-600 text-sm">Total</p>
            <p class="text-2xl font-bold">{{ stats.total }}</p>
        </div>
        <div class="bg-blue-50 p-4 rounded shadow">
            <p class="text-gray-600 text-sm">Abiertas</p>
            <p class="text-2xl font-bold text-blue-600">{{ stats.abiertas }}</p>
        </div>
        <div class="bg-yellow-50 p-4 rounded shadow">
            <p class="text-gray-600 text-sm">En Revisión</p>
            <p class="text-2xl font-bold text-yellow-600">{{ stats.en_revision }}</p>
        </div>
        <div class="bg-purple-50 p-4 rounded shadow">
            <p class="text-gray-600 text-sm">Con Concepto</p>
            <p class="text-2xl font-bold text-purple-600">{{ stats.con_concepto }}</p>
        </div>
        <div class="bg-green-50 p-4 rounded shadow">
            <p class="text-gray-600 text-sm">Resueltas</p>
            <p class="text-2xl font-bold text-green-600">{{ stats.resueltas }}</p>
        </div>
        <div class="bg-red-50 p-4 rounded shadow">
            <p class="text-gray-600 text-sm">Críticas</p>
            <p class="text-2xl font-bold text-red-600">{{ stats.criticas }}</p>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="bg-white p-4 rounded shadow mb-6">
        <form method="GET" class="flex gap-4 flex-wrap">
            <select name="estado" class="px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Todos los estados</option>
                <option value="Abierta" {% if request.args.get('estado') == 'Abierta' %}selected{% endif %}>Abierta</option>
                <option value="En revisión" {% if request.args.get('estado') == 'En revisión' %}selected{% endif %}>En revisión</option>
                <option value="En concepto" {% if request.args.get('estado') == 'En concepto' %}selected{% endif %}>En concepto</option>
                <option value="Resuelta" {% if request.args.get('estado') == 'Resuelta' %}selected{% endif %}>Resuelta</option>
                <option value="Cerrada" {% if request.args.get('estado') == 'Cerrada' %}selected{% endif %}>Cerrada</option>
            </select>
            
            <select name="prioridad" class="px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Todas las prioridades</option>
                <option value="Baja" {% if request.args.get('prioridad') == 'Baja' %}selected{% endif %}>Baja</option>
                <option value="Normal" {% if request.args.get('prioridad') == 'Normal' %}selected{% endif %}>Normal</option>
                <option value="Alta" {% if request.args.get('prioridad') == 'Alta' %}selected{% endif %}>Alta</option>
                <option value="Crítica" {% if request.args.get('prioridad') == 'Crítica' %}selected{% endif %}>Crítica</option>
            </select>
            
            <select name="riesgo" class="px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Todos los riesgos</option>
                <option value="Bajo" {% if request.args.get('riesgo') == 'Bajo' %}selected{% endif %}>Bajo</option>
                <option value="Medio" {% if request.args.get('riesgo') == 'Medio' %}selected{% endif %}>Medio</option>
                <option value="Alto" {% if request.args.get('riesgo') == 'Alto' %}selected{% endif %}>Alto</option>
                <option value="Crítico" {% if request.args.get('riesgo') == 'Crítico' %}selected{% endif %}>Crítico</option>
            </select>
            
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Filtrar
            </button>
        </form>
    </div>
    
    <!-- Listado de consultas -->
    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full">
            <thead class="bg-gray-100 border-b">
                <tr>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Número</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Título</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Tipo</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Estado</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Prioridad</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Riesgo</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for consulta in consultas.items %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-6 py-3 text-sm font-mono text-blue-600">
                        {{ consulta.numero_consulta }}
                    </td>
                    <td class="px-6 py-3 text-sm">{{ consulta.titulo[:40] }}...</td>
                    <td class="px-6 py-3 text-sm">{{ consulta.tipo_consulta }}</td>
                    <td class="px-6 py-3 text-sm">
                        <span class="px-2 py-1 rounded text-xs font-semibold
                                   {% if consulta.estado == 'Abierta' %}bg-blue-100 text-blue-800
                                   {% elif consulta.estado == 'En revisión' %}bg-yellow-100 text-yellow-800
                                   {% elif consulta.estado == 'En concepto' %}bg-purple-100 text-purple-800
                                   {% elif consulta.estado == 'Resuelta' %}bg-green-100 text-green-800
                                   {% elif consulta.estado == 'Cerrada' %}bg-gray-100 text-gray-800
                                   {% endif %}">
                            {{ consulta.estado }}
                        </span>
                    </td>
                    <td class="px-6 py-3 text-sm">
                        <span class="px-2 py-1 rounded text-xs font-semibold
                                   {% if consulta.prioridad == 'Crítica' %}bg-red-100 text-red-800
                                   {% elif consulta.prioridad == 'Alta' %}bg-orange-100 text-orange-800
                                   {% else %}bg-gray-100 text-gray-800
                                   {% endif %}">
                            {{ consulta.prioridad }}
                        </span>
                    </td>
                    <td class="px-6 py-3 text-sm">
                        <span class="px-2 py-1 rounded text-xs font-semibold
                                   {% if consulta.riesgo_legal == 'Crítico' %}bg-red-100 text-red-800
                                   {% elif consulta.riesgo_legal == 'Alto' %}bg-orange-100 text-orange-800
                                   {% elif consulta.riesgo_legal == 'Medio' %}bg-yellow-100 text-yellow-800
                                   {% else %}bg-green-100 text-green-800
                                   {% endif %}">
                            {{ consulta.riesgo_legal }}
                        </span>
                    </td>
                    <td class="px-6 py-3 text-sm">
                        <a href="{{ url_for('juridico.detalle_consulta', consulta_id=consulta.id) }}"
                           class="text-blue-600 hover:underline">Ver</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                        No hay consultas para mostrar
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Paginación -->
    <div class="mt-6 flex justify-center gap-2">
        {% if consultas.has_prev %}
        <a href="{{ url_for('juridico.listar', page=consultas.prev_num) }}"
           class="px-4 py-2 border rounded hover:bg-gray-100">← Anterior</a>
        {% endif %}
        
        <span class="px-4 py-2">Página {{ consultas.page }} de {{ consultas.pages }}</span>
        
        {% if consultas.has_next %}
        <a href="{{ url_for('juridico.listar', page=consultas.next_num) }}"
           class="px-4 py-2 border rounded hover:bg-gray-100">Siguiente →</a>
        {% endif %}
    </div>
</div>
{% endblock %}