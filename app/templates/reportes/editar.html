<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte {{ reporte.numero_reporte }} - SST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-12 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <a href="{{ url_for('reportes.listar') }}" class="text-blue-600 hover:underline mb-4 inline-flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Volver a Reportes
                </a>
                <h1 class="text-4xl font-bold text-gray-900">{{ reporte.titulo }}</h1>
                <p class="text-gray-600">{{ reporte.numero_reporte }}</p>
            </div>
            
            <!-- Estado -->
            <div class="mb-6 p-4 rounded-lg {% if reporte.estado == 'Reportado' %}bg-yellow-50 border border-yellow-200{% elif reporte.estado == 'Investigación' %}bg-orange-50 border border-orange-200{% else %}bg-green-50 border border-green-200{% endif %}">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-600">Estado</p>
                        <p class="text-xl font-bold">{{ reporte.estado }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Reportado por</p>
                        <p class="font-semibold">{{ reporte.reportador.nombre_completo if reporte.reportador else 'Desconocido' }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Contenido principal -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Columna izquierda (2/3) -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Detalles del Incidente -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-600">
                            <i class="fas fa-info-circle mr-2"></i> Detalles del Incidente
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Fecha</p>
                                    <p class="font-semibold">{{ reporte.fecha_creacion.strftime('%d de %B de %Y') }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Tipo de Reporte</p>
                                    <p class="font-semibold">{{ reporte.tipo_reporte_obj.nombre if reporte.tipo_reporte_obj else 'N/A' }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Tipo de Evidencia</p>
                                    <p class="font-semibold">{{ reporte.tipo_evidencia_obj.nombre if reporte.tipo_evidencia_obj else 'N/A' }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Ubicación</p>
                                    <p class="font-semibold">{{ reporte.ubicacion_incidente.nombre if reporte.ubicacion_incidente else 'No especificada' }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Descripción -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4 text-orange-600">
                            <i class="fas fa-file-alt mr-2"></i> Descripción
                        </h2>
                        <p class="text-gray-700 leading-relaxed">{{ reporte.descripcion }}</p>
                    </div>
                    
                    <!-- Imagen si existe -->
                    {% if reporte.imagen_url %}
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4 text-red-600">
                            <i class="fas fa-image mr-2"></i> Evidencia Fotográfica
                        </h2>
                        <img src="{{ reporte.imagen_url }}" alt="Evidencia" class="max-w-full h-auto rounded">
                    </div>
                    {% endif %}
                </div>
                
                <!-- Columna derecha (1/3) -->
                <div class="space-y-6">
                    <!-- Información del Reportador -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="font-bold mb-4 flex items-center">
                            <i class="fas fa-user mr-2 text-blue-600"></i> Reportador
                        </h3>
                        <div class="space-y-2 text-sm">
                            <p><span class="text-gray-600">Nombre:</span> {{ reporte.reportador_nombre }}</p>
                            <p><span class="text-gray-600">Cargo:</span> {{ reporte.reportador_cargo or 'N/A' }}</p>
                            <p><span class="text-gray-600">Email:</span> {{ reporte.reportador.email if reporte.reportador else 'N/A' }}</p>
                        </div>
                    </div>
                    
                    <!-- Responsable SST -->
                    {% if reporte.responsable_sst %}
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="font-bold mb-4 flex items-center">
                            <i class="fas fa-user-shield mr-2 text-green-600"></i> Responsable SST
                        </h3>
                        <div class="space-y-2 text-sm">
                            <p><span class="text-gray-600">Nombre:</span> {{ reporte.responsable_sst.nombre_completo }}</p>
                            <p><span class="text-gray-600">Email:</span> {{ reporte.responsable_sst.email }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Acciones -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="font-bold mb-4">Acciones</h3>
                        <div class="space-y-2">
                            {% if reporte.empleado_reportador_id == current_user.id or current_user.rol in ['Admin', 'Responsable_SST'] %}
                                <a href="{{ url_for('reportes.editar', id=reporte.id) }}" class="block w-full bg-blue-600 text-white text-center px-4 py-2 rounded hover:bg-blue-700">
                                    <i class="fas fa-edit mr-2"></i> Editar
                                </a>
                            {% endif %}
                            
                            {% if current_user.rol in ['Admin', 'Responsable_SST'] and reporte.estado != 'Cerrado' %}
                                <form method="POST" action="{{ url_for('reportes.cerrar', id=reporte.id) }}">
                                    <button type="submit" class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="return confirm('¿Cerrar este reporte?')">
                                        <i class="fas fa-check mr-2"></i> Cerrar Reporte
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>